# 🏗️ Diagramas da Arquitetura CNN

## **Arquitetura Completa do Modelo**

```
┌─────────────────────────────────────────────────────────────────┐
│                    INPUT LAYER                                  │
│              (224, 224, 3) RGB Image                           │
└─────────────────────┬───────────────────────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────────────────────┐
│                EFFICIENTNETB0 BACKBONE                         │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐    │
│  │ Conv2D  │ │ MBConv  │ │ MBConv  │ │ MBConv  │ │ MBConv  │    │
│  │ 3x3     │ │ Block 1 │ │ Block 2 │ │ Block 3 │ │ Block 4 │    │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘    │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐    │
│  │ MBConv  │ │ MBConv  │ │ MBConv  │ │ MBConv  │ │ Conv2D  │    │
│  │ Block 5 │ │ Block 6 │ │ Block 7 │ │ Block 8 │ │ 1x1     │    │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘    │
└─────────────────────┬───────────────────────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────────────────────┐
│              GLOBAL AVERAGE POOLING 2D                          │
│                    (1280,)                                      │
└─────────────────────┬───────────────────────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────────────────────┐
│                    DROPOUT (0.6)                                │
└─────────────────────┬───────────────────────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────────────────────┐
│                DENSE LAYER 1                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Dense(512, activation='relu') + L2(0.001)              │   │
│  │ BatchNormalization()                                    │   │
│  │ Dropout(0.5)                                           │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────┬───────────────────────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────────────────────┐
│                DENSE LAYER 2                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Dense(256, activation='relu') + L2(0.001)              │   │
│  │ BatchNormalization()                                    │   │
│  │ Dropout(0.4)                                           │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────┬───────────────────────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────────────────────┐
│                DENSE LAYER 3                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ Dense(128, activation='relu') + L2(0.001)             │   │
│  │ BatchNormalization()                                    │   │
│  │ Dropout(0.3)                                           │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────┬───────────────────────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────────────────────┐
│                OUTPUT LAYER                                    │
│              Dense(16, activation='softmax')                   │
│              [16 classes de insetos]                         │
└─────────────────────────────────────────────────────────────────┘
```

## **Fluxo de Dados e Dimensões**

```
Input: (224, 224, 3)
    ↓
EfficientNetB0: (224, 224, 3) → (7, 7, 1280)
    ↓
GlobalAveragePooling2D: (7, 7, 1280) → (1280,)
    ↓
Dropout(0.6): (1280,) → (1280,)
    ↓
Dense(512) + BN + Dropout(0.5): (1280,) → (512,)
    ↓
Dense(256) + BN + Dropout(0.4): (512,) → (256,)
    ↓
Dense(128) + BN + Dropout(0.3): (256,) → (128,)
    ↓
Dense(16) + Softmax: (128,) → (16,)
```

## **Estratégia de Treinamento**

```
┌─────────────────────────────────────────────────────────────────┐
│                    FASE 1: TRANSFER LEARNING                    │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ • EfficientNetB0 CONGELADO (todos os pesos fixos)          │ │
│  │ • Treinar apenas camadas densas                            │ │
│  │ • Learning Rate: 0.001                                     │ │
│  │ • Épocas: 20                                                │ │
│  │ • Monitor: val_loss                                         │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────┬───────────────────────────────────────────┘
                      │
┌─────────────────────▼───────────────────────────────────────────┐
│                    FASE 2: FINE-TUNING                         │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ • Descongelar últimas 30 camadas do EfficientNetB0        │ │
│  │ • Learning Rate: 0.00001 (10x menor)                      │ │
│  │ • Épocas: 15                                               │ │
│  │ • Monitor: val_loss                                        │ │
│  │ • Callbacks: EarlyStopping, ReduceLROnPlateau              │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## **Callbacks e Monitoramento**

```
┌─────────────────────────────────────────────────────────────────┐
│                        CALLBACKS                                │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ EarlyStopping:                                             │ │
│  │ • patience=10                                              │ │
│  │ • monitor='val_loss'                                       │ │
│  │ • restore_best_weights=True                               │ │
│  └─────────────────────────────────────────────────────────────┘ │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ ReduceLROnPlateau:                                         │ │
│  │ • factor=0.3                                              │ │
│  │ • patience=5                                               │ │
│  │ • min_lr=1e-6                                             │ │
│  │ • monitor='val_loss'                                       │ │
│  └─────────────────────────────────────────────────────────────┘ │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ ModelCheckpoint:                                           │ │
│  │ • monitor='val_accuracy'                                   │ │
│  │ • save_best_only=True                                     │ │
│  │ • filename='best_model.h5'                                │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## **Data Augmentation Pipeline**

```
┌─────────────────────────────────────────────────────────────────┐
│                    DATA AUGMENTATION                            │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ Input Image (224, 224, 3)                                  │ │
│  └─────────────────────┬───────────────────────────────────────┘ │
│                        │                                        │
│  ┌─────────────────────▼───────────────────────────────────────┐ │
│  │ • Rotation: ±15°                                           │ │
│  │ • Width Shift: ±10%                                        │ │
│  │ • Height Shift: ±10%                                       │ │
│  │ • Horizontal Flip: 50% chance                             │ │
│  │ • Brightness: [0.9, 1.1]                                  │ │
│  │ • Zoom: [0.9, 1.1]                                        │ │
│  │ • Shear: ±5%                                               │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                        │                                        │
│  ┌─────────────────────▼───────────────────────────────────────┐ │
│  │ Augmented Image (224, 224, 3)                              │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## **Class Weights Calculation**

```
┌─────────────────────────────────────────────────────────────────┐
│                    CLASS WEIGHTS                               │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ Fórmula: n_samples / (n_classes * np.bincount(y))          │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  Exemplo para dataset balanceado:                               │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ Classe        │ Amostras │ Peso Calculado                  │ │
│  │ aranhas       │ 1000     │ 1.0                            │ │
│  │ joaninhas     │ 1000     │ 1.0                            │ │
│  │ libelulas     │ 73       │ 13.7                           │ │
│  │ mosca_asilidea│ 425      │ 2.4                            │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## **TensorFlow Lite Conversion**

```
┌─────────────────────────────────────────────────────────────────┐
│                    MODEL CONVERSION                            │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ Keras Model (.h5)                                           │ │
│  │ • Size: ~50MB                                              │ │
│  │ • Precision: Float32                                        │ │
│  └─────────────────────┬───────────────────────────────────────┘ │
│                        │                                        │
│  ┌─────────────────────▼───────────────────────────────────────┐ │
│  │ TFLiteConverter:                                            │ │
│  │ • optimizations=[DEFAULT]                                  │ │
│  │ • Post-training quantization                               │ │
│  └─────────────────────┬───────────────────────────────────────┘ │
│                        │                                        │
│  ┌─────────────────────▼───────────────────────────────────────┐ │
│  │ TensorFlow Lite Model (.tflite)                             │ │
│  │ • Size: ~10MB (80% reduction)                               │ │
│  │ • Precision: Int8                                           │ │
│  │ • Mobile optimized                                         │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## **Performance Metrics**

```
┌─────────────────────────────────────────────────────────────────┐
│                    EVALUATION METRICS                          │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ Primary Metrics:                                           │ │
│  │ • Accuracy: TP+TN / (TP+TN+FP+FN)                         │ │
│  │ • Top-3 Accuracy: Classe verdadeira entre top 3           │ │
│  │ • Loss: Categorical Crossentropy                         │ │
│  └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │ Expected Performance:                                     │ │
│  │ • Previous Model: 25.6% accuracy                          │ │
│  │ • Target Model: 70-85% accuracy                           │ │
│  │ • Improvement: +200-300%                                  │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📊 **Resumo da Arquitetura**

**Total de Parâmetros**: ~5.3M (EfficientNetB0) + ~1.2M (Dense layers) = ~6.5M  
**Tamanho do Modelo**: ~50MB (H5) → ~10MB (TFLite)  
**Tempo de Inferência**: ~50ms (CPU mobile)  
**Classes**: 16 tipos de insetos  
**Dataset**: 12.155 imagens balanceadas

Esta arquitetura segue as melhores práticas da literatura científica para classificação de imagens com transfer learning! 🚀
